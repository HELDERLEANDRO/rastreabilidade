name: keep-streamlit-awake

on:
  schedule:
    - cron: "0 */6 * * *"   # a cada 6 horas
  workflow_dispatch:

jobs:
  open:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - run: npm i -D playwright
      - run: npx playwright install --with-deps chromium

      - name: Open Streamlit app (real browser)
        run: |
          node - <<'NODE'
          const { chromium } = require('playwright');

          (async () => {
            const url = "https://rastreabilidade-mpqnryjwpgzynyv2hvqfci.streamlit.app/?palete=PAL-20251214-001";
            const browser = await chromium.launch();
            const page = await browser.newPage();

            await page.goto(url, { waitUntil: 'networkidle', timeout: 60000 });
            await page.waitForTimeout(20000); // segura 20s aberto

            await browser.close();
            console.log("OK - opened:", url);
          })();
          NODE
